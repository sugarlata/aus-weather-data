name: Deploy Sphinx documentation to Pages

on:
  push:
    # branches: [main] # branch to trigger deployment

jobs:
  pages:
    runs-on: ubuntu-20.04
    permissions:
      pages: write
      id-token: write
    steps:

    - uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v3
      with:
        version: "0.4.22"
    
    - name: Set up Python
      run: uv python install 3.9

    - name: Generate Dev Requirements
      run: uv pip freeze > dev-requirements.txt

    - name: Cache Dependencies
      uses: actions/cache@v2
      with:
        path: ${{ steps.pip-cache.outputs.dir }}
        key: ${{ runner.os }}-pip-${{ hashFiles('**/dev-requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - id: deployment
      uses: sphinx-notes/pages@v3
      with:
        checkout: false
        documentation_path: ./docs/source
        requirements_path: ./dev-requirements.txt
        cache: true
        publish: true